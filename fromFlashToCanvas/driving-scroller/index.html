<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>Vertical Driving Scroller — Shoot the Aliens</title>
    <style>
      html, body { margin: 0; height: 100%; overflow: hidden; background: #000; color: #cfe8ff; font-family: system-ui, sans-serif; }
      #game { position: absolute; inset: 0; width: 100vw; height: 100vh; display: block; touch-action: none; user-select: none; }
      #hud { position: fixed; left: 10px; top: 10px; z-index: 2; font-size: 13px; background: rgba(15,22,34,0.85); border: 1px solid rgba(140,200,255,0.35); border-radius: 10px; padding: 8px 10px; backdrop-filter: blur(6px); }
      #help { position: fixed; left: 10px; bottom: 10px; font-size: 12px; opacity: 0.85; }
    </style>
  </head>
  <body>
    <canvas id="game"></canvas>
    <div id="hud">Score: <span id="score">0</span> • Lives: <span id="lives">3</span> • Level: <span id="lvl">1</span></div>
    <div id="help">Controls: Drag to move • Double‑tap to shoot • Keyboard: ←/→ to steer, Space shoot, R restart</div>
    <script>
      ;(() => {
        const cv = document.getElementById('game')
        const ctx = cv.getContext('2d')
        const dpr = Math.max(1, window.devicePixelRatio || 1)

        let W = 0, H = 0
        function resize(){
          const cssW = cv.clientWidth || window.innerWidth
          const cssH = cv.clientHeight || window.innerHeight
          cv.width = Math.floor(cssW * dpr)
          cv.height = Math.floor(cssH * dpr)
          W = cv.width; H = cv.height
        }
        window.addEventListener('resize', resize)
        resize()

        // UI refs
        const ui = { score: document.getElementById('score'), lives: document.getElementById('lives'), lvl: document.getElementById('lvl') }

        // Input
        const keys = { left: false, right: false, shoot: false }
        let requestFire = false
        let touchActive = false
        let lastTapT = 0, lastTapX = 0, lastTapY = 0

        window.addEventListener('keydown', e => {
          if (e.code === 'ArrowLeft' || e.code === 'KeyA') keys.left = true
          else if (e.code === 'ArrowRight' || e.code === 'KeyD') keys.right = true
          else if (e.code === 'Space') { keys.shoot = true; e.preventDefault() }
          else if (e.code === 'KeyR') resetGame()
        })
        window.addEventListener('keyup', e => {
          if (e.code === 'ArrowLeft' || e.code === 'KeyA') keys.left = false
          else if (e.code === 'ArrowRight' || e.code === 'KeyD') keys.right = false
          else if (e.code === 'Space') keys.shoot = false
        })

        function getPointer(e){ const r = cv.getBoundingClientRect(); return { x: (e.clientX - r.left) * dpr, y: (e.clientY - r.top) * dpr } }
        function clamp(v, a, b){ return Math.max(a, Math.min(b, v)) }

        cv.addEventListener('pointerdown', e => {
          e.preventDefault(); cv.setPointerCapture(e.pointerId)
          const p = getPointer(e)
          const dt = e.timeStamp - lastTapT
          const dx = p.x - lastTapX, dy = p.y - lastTapY
          if (dt > 0 && dt < 300 && (dx*dx + dy*dy) < (48*48*dpr*dpr)) requestFire = true
          lastTapT = e.timeStamp; lastTapX = p.x; lastTapY = p.y
          touchActive = true
          player.x = clamp(p.x, laneL + 20*dpr, laneR - 20*dpr)
        }, { passive: false })
        cv.addEventListener('pointermove', e => { if (!touchActive) return; const p = getPointer(e); player.x = clamp(p.x, laneL + 20*dpr, laneR - 20*dpr) })
        function endTouch(e){ try{ cv.releasePointerCapture(e.pointerId) }catch(_){} touchActive = false }
        cv.addEventListener('pointerup', endTouch)
        cv.addEventListener('pointercancel', endTouch)

        // World
        let laneL = W*0.2, laneR = W*0.8
        function updateLanes(){ laneL = W*0.2; laneR = W*0.8 }
        updateLanes()
        let roadOffset = 0
        function drawRoad(dt){
          // background gradient
          const g = ctx.createLinearGradient(0, 0, 0, H)
          g.addColorStop(0, '#061018')
          g.addColorStop(1, '#0b121b')
          ctx.fillStyle = g
          ctx.fillRect(0, 0, W, H)
          // road
          ctx.fillStyle = '#1a2533'
          ctx.fillRect(laneL, 0, laneR - laneL, H)
          // lane markings
          ctx.fillStyle = '#8cc8ff'
          const segH = 40 * dpr
          roadOffset = (roadOffset + dt * world.speed * 0.06) % (segH*2)
          for (let y = -segH*2 + roadOffset; y < H; y += segH*2){
            ctx.fillRect((laneL+laneR)/2 - 4*dpr, y, 8*dpr, segH)
          }
        }

        // Entities
        const state = { score: 0, lives: 3, level: 1, running: true }
        const world = { speed: 220 * dpr }
        const player = { x: (laneL+laneR)/2, y: H*0.82, w: 22*dpr, h: 28*dpr, speed: 6*dpr, fireCdMs: 130, fireAcc: 0 }
        const bullets = [] // {x,y,vy,r}
        const aliens = []  // {x,y,vy,w,h,hp,ax,ay,t,kind}
        const rocks = []   // obstacles {x,y,vy,w,h,hp}

        function drawPlayer(){
          // simple ship
          ctx.fillStyle = '#9fd6ff'
          ctx.fillRect(player.x - player.w*0.6, player.y - player.h*0.15, player.w*1.2, player.h*0.3)
          ctx.fillRect(player.x - player.w*0.15, player.y - player.h*0.7, player.w*0.3, player.h*0.6)
        }

        function spawnAlien(){
          const w = 26*dpr, h = 20*dpr
          const x = laneL + 30*dpr + Math.random() * (laneR - laneL - 60*dpr)
          const y = -40*dpr
          const vy = (world.speed * 0.4) + Math.random()* (world.speed*0.2)
          const kind = (Math.random()*3)|0
          aliens.push({ x, y, vy, w, h, hp: 2, ax: (Math.random()*2-1) * 0.9*dpr, ay: 0, t: 0, kind })
        }
        function spawnRock(){
          const w = (20 + Math.random()*30) * dpr
          const h = (14 + Math.random()*28) * dpr
          const x = laneL + 20*dpr + Math.random() * (laneR - laneL - 40*dpr)
          const y = -h
          const vy = world.speed * (0.35 + Math.random()*0.2)
          rocks.push({ x, y, w, h, vy, hp: 3 })
        }

        let alienSpawnAcc = 0, rockSpawnAcc = 0
        function maybeSpawn(dt){
          alienSpawnAcc += dt; rockSpawnAcc += dt
          if (alienSpawnAcc > 650){ alienSpawnAcc = 0; spawnAlien() }
          if (rockSpawnAcc > 900){ rockSpawnAcc = 0; spawnRock() }
        }

        function fire(){ bullets.push({ x: player.x, y: player.y - player.h*0.8, vy: -8*dpr, r: 3*dpr }) }

        function aabb(ax,ay,aw,ah,bx,by,bw,bh){ return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by }
        function bulletHitsRect(b, r){
          const cx = Math.max(r.x, Math.min(b.x, r.x + r.w))
          const cy = Math.max(r.y, Math.min(b.y, r.y + r.h))
          const dx = b.x - cx, dy = b.y - cy
          return dx*dx + dy*dy <= b.r*b.r
        }

        function resetGame(){
          state.score = 0; state.lives = 3; state.level = 1; world.speed = 220*dpr
          bullets.length = 0; aliens.length = 0; rocks.length = 0
          player.x = (laneL+laneR)/2; player.y = H*0.82; player.fireAcc = 0
          state.running = true
          updateUI()
        }
        function nextLevel(){
          state.level += 1
          world.speed *= 1.1
          bullets.length = 0; aliens.length = 0; rocks.length = 0
          updateUI()
        }
        function updateUI(){ ui.score.textContent = state.score|0; ui.lives.textContent = state.lives; ui.lvl.textContent = state.level }

        // Loop
        let last = performance.now()
        function step(){
          const now = performance.now(); let dt = now - last; if (dt > 80) dt = 80; last = now
          updateLanes()
          // Input
          let vx = 0
          if (keys.left) vx -= player.speed
          if (keys.right) vx += player.speed
          player.x = clamp(player.x + vx, laneL + 20*dpr, laneR - 20*dpr)

          // Shooting cooldown
          player.fireAcc += dt
          if ((keys.shoot || requestFire) && player.fireAcc >= player.fireCdMs){ fire(); player.fireAcc = 0; requestFire = false }

          // Spawn
          if (state.running) maybeSpawn(dt)

          // Update bullets
          for (let i=0;i<bullets.length;i++){
            const b = bullets[i]; b.y += b.vy
            if (b.y < -20){ bullets.splice(i--,1); continue }
            // vs aliens
            for (let j=0;j<aliens.length;j++){
              const a = aliens[j]
              if (bulletHitsRect(b, {x:a.x-a.w/2,y:a.y-a.h/2,w:a.w,h:a.h})){
                a.hp -= 1; bullets.splice(i--,1); if (a.hp<=0){ aliens.splice(j--,1); state.score += 50 }
                break
              }
            }
            // vs rocks
            for (let j=0;j<rocks.length && i>=0;j++){
              const r = rocks[j]
              if (bulletHitsRect(b, r)){
                r.hp -= 1; bullets.splice(i--,1); if (r.hp<=0){ rocks.splice(j--,1); state.score += 25 }
              }
            }
          }

          // Update aliens
          for (let i=0;i<aliens.length;i++){
            const a = aliens[i]
            a.t += dt * 0.005
            const wave = Math.sin(a.t*2 + a.kind) * 1.5*dpr
            a.x += a.ax + wave
            a.y += a.vy * (dt/1000)
            if (a.y - a.h/2 > H + 30){ aliens.splice(i--,1); continue }
            if (aabb(a.x-a.w/2,a.y-a.h/2,a.w,a.h, player.x-player.w/2, player.y-player.h/2, player.w, player.h)){
              aliens.splice(i--,1); damage()
            }
          }
          // Update rocks
          for (let i=0;i<rocks.length;i++){
            const r = rocks[i]
            r.y += r.vy * (dt/1000)
            if (r.y - r.h > H + 30){ rocks.splice(i--,1); continue }
            if (aabb(r.x,r.y,r.w,r.h, player.x-player.w/2, player.y-player.h/2, player.w, player.h)){
              rocks.splice(i--,1); damage()
            }
          }

          // Level progression
          if (state.running && state.score >= state.level * 800){ nextLevel() }

          updateUI()
        }

        function damage(){
          state.lives -= 1
          if (state.lives <= 0){ state.running = false }
          else { player.x = (laneL+laneR)/2; bullets.length = 0 }
        }

        function render(){
          drawRoad(16)
          // Draw rocks
          ctx.fillStyle = '#5f7a99'
          for (const r of rocks){ ctx.fillRect(r.x, r.y, r.w, r.h) }
          // Draw aliens
          for (const a of aliens){
            ctx.fillStyle = '#7effff'
            ctx.fillRect(a.x - a.w/2, a.y - a.h/2, a.w, a.h)
            ctx.fillStyle = '#09131d'; ctx.fillRect(a.x - a.w*0.2, a.y - a.h*0.15, a.w*0.15, a.h*0.12)
            ctx.fillRect(a.x + a.w*0.05, a.y - a.h*0.15, a.w*0.15, a.h*0.12)
          }
          // Draw bullets
          ctx.fillStyle = '#ffea00'
          for (const b of bullets){ ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill() }
          // Draw player
          drawPlayer()

          if (!state.running){
            ctx.fillStyle = '#cfe8ff'; ctx.font = (18*dpr)+'px monospace'
            const msg = 'Game Over — Press R to Restart'
            const w = ctx.measureText(msg).width
            ctx.fillText(msg, (W - w)/2, H*0.5)
          }
        }

        function loop(){
          step(); render(); requestAnimationFrame(loop)
        }
        loop()
      })()
    </script>
  </body>
  </html>

